User-agent: Googlebot
Allow: /

User-agent: Bingbot
Allow: /

User-agent: Twitterbot
Allow: /

User-agent: facebookexternalhit
Allow: /

User-agent: *
Allow: /

# ğŸ—ï¸ COMPLETE BACKEND ARCHITECTURE - No Code, Just Info

Got it buddy! Here's the complete architecture, folder structure, endpoints, and packages info.

---

## ğŸ“ FOLDER STRUCTURE

```
project-root/
â”‚
â”œâ”€â”€ server/                          # Backend
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ db.js                   # MongoDB connection
â”‚   â”‚   â”œâ”€â”€ email.config.js         # Nodemailer setup
â”‚   â”‚   â”œâ”€â”€ sms.config.js           # Twilio setup
â”‚   â”‚   â”œâ”€â”€ payment.config.js       # Payment gateway configs
â”‚   â”‚   â”œâ”€â”€ gemini.config.js        # Google Gemini AI setup
â”‚   â”‚   â””â”€â”€ cloudinary.config.js    # Image upload (optional)
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ User.js
â”‚   â”‚   â”œâ”€â”€ OTPLog.js
â”‚   â”‚   â”œâ”€â”€ Region.js
â”‚   â”‚   â”œâ”€â”€ Product.js
â”‚   â”‚   â”œâ”€â”€ Cart.js
â”‚   â”‚   â”œâ”€â”€ Order.js
â”‚   â”‚   â”œâ”€â”€ Payment.js
â”‚   â”‚   â”œâ”€â”€ Subscription.js
â”‚   â”‚   â”œâ”€â”€ EmailLog.js
â”‚   â”‚   â”œâ”€â”€ SMSLog.js
â”‚   â”‚   â”œâ”€â”€ Chat.js
â”‚   â”‚   â”œâ”€â”€ Ticket.js
â”‚   â”‚   â”œâ”€â”€ Note.js
â”‚   â”‚   â”œâ”€â”€ HelpArticle.js
â”‚   â”‚   â”œâ”€â”€ FAQ.js
â”‚   â”‚   â”œâ”€â”€ ImpersonationLog.js
â”‚   â”‚   â””â”€â”€ AdminActionLog.js
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ auth.controller.js
â”‚   â”‚   â”œâ”€â”€ user.controller.js
â”‚   â”‚   â”œâ”€â”€ region.controller.js
â”‚   â”‚   â”œâ”€â”€ product.controller.js
â”‚   â”‚   â”œâ”€â”€ cart.controller.js
â”‚   â”‚   â”œâ”€â”€ order.controller.js
â”‚   â”‚   â”œâ”€â”€ payment.controller.js
â”‚   â”‚   â”œâ”€â”€ subscription.controller.js
â”‚   â”‚   â”œâ”€â”€ admin.controller.js
â”‚   â”‚   â”œâ”€â”€ customer.controller.js
â”‚   â”‚   â”œâ”€â”€ impersonation.controller.js
â”‚   â”‚   â”œâ”€â”€ chat.controller.js
â”‚   â”‚   â”œâ”€â”€ ticket.controller.js
â”‚   â”‚   â”œâ”€â”€ notification.controller.js
â”‚   â”‚   â”œâ”€â”€ analytics.controller.js
â”‚   â”‚   â””â”€â”€ help.controller.js
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth.routes.js
â”‚   â”‚   â”œâ”€â”€ user.routes.js
â”‚   â”‚   â”œâ”€â”€ region.routes.js
â”‚   â”‚   â”œâ”€â”€ product.routes.js
â”‚   â”‚   â”œâ”€â”€ cart.routes.js
â”‚   â”‚   â”œâ”€â”€ order.routes.js
â”‚   â”‚   â”œâ”€â”€ payment.routes.js
â”‚   â”‚   â”œâ”€â”€ subscription.routes.js
â”‚   â”‚   â”œâ”€â”€ admin.routes.js
â”‚   â”‚   â”œâ”€â”€ customer.routes.js
â”‚   â”‚   â”œâ”€â”€ impersonation.routes.js
â”‚   â”‚   â”œâ”€â”€ chat.routes.js
â”‚   â”‚   â”œâ”€â”€ ticket.routes.js
â”‚   â”‚   â”œâ”€â”€ notification.routes.js
â”‚   â”‚   â”œâ”€â”€ analytics.routes.js
â”‚   â”‚   â””â”€â”€ help.routes.js
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.middleware.js          # JWT verification
â”‚   â”‚   â”œâ”€â”€ roleCheck.middleware.js     # Admin/customer check
â”‚   â”‚   â”œâ”€â”€ impersonation.middleware.js # Impersonation validation
â”‚   â”‚   â”œâ”€â”€ validation.middleware.js    # Input validation
â”‚   â”‚   â”œâ”€â”€ errorHandler.middleware.js  # Global error handler
â”‚   â”‚   â”œâ”€â”€ rateLimiter.middleware.js   # Rate limiting
â”‚   â”‚   â””â”€â”€ upload.middleware.js        # File upload (Multer)
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ email.service.js           # Send emails
â”‚   â”‚   â”œâ”€â”€ sms.service.js             # Send SMS
â”‚   â”‚   â”œâ”€â”€ payment.service.js         # Payment processing
â”‚   â”‚   â”œâ”€â”€ gemini.service.js          # AI chatbot
â”‚   â”‚   â”œâ”€â”€ notification.service.js    # Unified notifications
â”‚   â”‚   â”œâ”€â”€ pdf.service.js             # Invoice generation
â”‚   â”‚   â”œâ”€â”€ csv.service.js             # CSV export
â”‚   â”‚   â””â”€â”€ geoip.service.js           # IP-based region detection
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ generateId.js              # Generate unique IDs
â”‚   â”‚   â”œâ”€â”€ jwt.js                     # JWT sign/verify
â”‚   â”‚   â”œâ”€â”€ encryption.js              # Password hashing
â”‚   â”‚   â”œâ”€â”€ validators.js              # Custom validators
â”‚   â”‚   â”œâ”€â”€ dateHelpers.js             # Date calculations
â”‚   â”‚   â””â”€â”€ responseFormatter.js       # Standardized responses
â”‚   â”‚
â”‚   â”œâ”€â”€ jobs/
â”‚   â”‚   â”œâ”€â”€ expiryCheck.job.js         # Check expiring subscriptions
â”‚   â”‚   â”œâ”€â”€ autoSuspend.job.js         # Auto-suspend expired
â”‚   â”‚   â”œâ”€â”€ emailReminder.job.js       # Send reminder emails
â”‚   â”‚   â””â”€â”€ cleanup.job.js             # Database cleanup
â”‚   â”‚
â”‚   â”œâ”€â”€ socket/
â”‚   â”‚   â”œâ”€â”€ chat.socket.js             # Socket.io chat handlers
â”‚   â”‚   â””â”€â”€ notification.socket.js     # Real-time notifications
â”‚   â”‚
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”œâ”€â”€ emails/
â”‚   â”‚   â”‚   â”œâ”€â”€ welcome.html
â”‚   â”‚   â”‚   â”œâ”€â”€ otp.html
â”‚   â”‚   â”‚   â”œâ”€â”€ passwordReset.html
â”‚   â”‚   â”‚   â”œâ”€â”€ orderConfirmation.html
â”‚   â”‚   â”‚   â”œâ”€â”€ subscriptionActivation.html
â”‚   â”‚   â”‚   â”œâ”€â”€ expiryReminder.html
â”‚   â”‚   â”‚   â”œâ”€â”€ suspension.html
â”‚   â”‚   â”‚   â”œâ”€â”€ renewal.html
â”‚   â”‚   â”‚   â””â”€â”€ refund.html
â”‚   â”‚   â””â”€â”€ invoices/
â”‚   â”‚       â””â”€â”€ invoice.template.html
â”‚   â”‚
â”‚   â”œâ”€â”€ seeders/                       # Initial data (optional)
â”‚   â”‚   â”œâ”€â”€ admin.seeder.js
â”‚   â”‚   â”œâ”€â”€ region.seeder.js
â”‚   â”‚   â””â”€â”€ product.seeder.js
â”‚   â”‚
â”‚   â”œâ”€â”€ .env                           # Environment variables
â”‚   â”œâ”€â”€ .env.example                   # Example env file
â”‚   â”œâ”€â”€ server.js                      # Main entry point
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ client/                            # Frontend
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”‚   â””â”€â”€ images/
â”‚   â”‚
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Login.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Register.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ForgotPassword.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ResetPassword.jsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ TwoFactorAuth.jsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ customer/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Products.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProductDetails.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Cart.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Checkout.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Orders.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ OrderDetails.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Subscriptions.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Profile.jsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Support.jsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CustomerList.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CustomerDetails.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProductManagement.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ OrderManagement.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RegionManagement.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ EmailLogs.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SMSLogs.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TicketManagement.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TicketDetails.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LiveChat.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Analytics.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ImpersonationLogs.jsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ImpersonationModal.jsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ public/                # Marketing website
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Home.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProductPage.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SolutionsPage.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PricingPage.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AboutPage.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ContactPage.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BlogHome.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BlogPost.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ HelpCenter.jsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ResourcesPage.jsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ shared/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Navbar.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Footer.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Chatbot.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ImpersonationBanner.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Table.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Button.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Input.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Card.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Badge.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Loader.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Toast.jsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ProtectedRoute.jsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ payment/
â”‚   â”‚   â”‚       â”œâ”€â”€ StripeCheckout.jsx
â”‚   â”‚   â”‚       â”œâ”€â”€ PayPalCheckout.jsx
â”‚   â”‚   â”‚       â”œâ”€â”€ RazorpayCheckout.jsx
â”‚   â”‚   â”‚       â”œâ”€â”€ PaymentSuccess.jsx
â”‚   â”‚   â”‚       â””â”€â”€ PaymentFailed.jsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ HomePage.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ CustomerPortal.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AdminPortal.jsx
â”‚   â”‚   â”‚   â””â”€â”€ NotFound.jsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthContext.js
â”‚   â”‚   â”‚   â”œâ”€â”€ CartContext.js
â”‚   â”‚   â”‚   â”œâ”€â”€ ImpersonationContext.js
â”‚   â”‚   â”‚   â””â”€â”€ ChatContext.js
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.js
â”‚   â”‚   â”‚   â”œâ”€â”€ useCart.js
â”‚   â”‚   â”‚   â”œâ”€â”€ useSocket.js
â”‚   â”‚   â”‚   â””â”€â”€ useImpersonation.js
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.js                 # Axios instance
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.service.js
â”‚   â”‚   â”‚   â”œâ”€â”€ product.service.js
â”‚   â”‚   â”‚   â”œâ”€â”€ cart.service.js
â”‚   â”‚   â”‚   â”œâ”€â”€ order.service.js
â”‚   â”‚   â”‚   â”œâ”€â”€ subscription.service.js
â”‚   â”‚   â”‚   â”œâ”€â”€ payment.service.js
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.service.js
â”‚   â”‚   â”‚   â”œâ”€â”€ ticket.service.js
â”‚   â”‚   â”‚   â”œâ”€â”€ admin.service.js
â”‚   â”‚   â”‚   â””â”€â”€ socket.service.js
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ constants.js
â”‚   â”‚   â”‚   â”œâ”€â”€ validators.js
â”‚   â”‚   â”‚   â”œâ”€â”€ helpers.js
â”‚   â”‚   â”‚   â””â”€â”€ formatters.js
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”‚   â””â”€â”€ global.css
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ App.jsx
â”‚   â”‚   â”œâ”€â”€ main.jsx
â”‚   â”‚   â””â”€â”€ routes.jsx
â”‚   â”‚
â”‚   â”œâ”€â”€ .env
â”‚   â”œâ”€â”€ .env.example
â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â”œâ”€â”€ postcss.config.js
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

---

## ğŸ”Œ COMPLETE API ENDPOINTS

### **1. AUTHENTICATION ROUTES** (`/api/auth`)

```
POST   /api/auth/register              # Register new user
POST   /api/auth/verify-email          # Verify email with OTP
POST   /api/auth/resend-otp            # Resend verification OTP
POST   /api/auth/login                 # Login user
POST   /api/auth/login/verify-2fa      # Verify 2FA OTP during login
POST   /api/auth/logout                # Logout user
POST   /api/auth/refresh-token         # Refresh JWT token
POST   /api/auth/forgot-password       # Request password reset
POST   /api/auth/reset-password/:token # Reset password with token
POST   /api/auth/verify-token          # Verify if token is valid
```

### **2. USER ROUTES** (`/api/user`) - Protected

```
GET    /api/user/profile               # Get user profile
PUT    /api/user/profile               # Update user profile
PUT    /api/user/change-password       # Change password
POST   /api/user/enable-2fa            # Enable 2FA
POST   /api/user/disable-2fa           # Disable 2FA
POST   /api/user/verify-2fa            # Verify 2FA setup
GET    /api/user/email-logs            # Get user's email logs
GET    /api/user/sms-logs              # Get user's SMS logs
DELETE /api/user/account               # Delete account
```

### **3. REGION ROUTES** (`/api/regions`)

```
GET    /api/regions                    # Get all active regions (public)
GET    /api/regions/:id                # Get single region (public)

# Admin only:
POST   /api/regions                    # Create region
PUT    /api/regions/:id                # Update region
DELETE /api/regions/:id                # Delete region
PUT    /api/regions/:id/restrictions   # Update product restrictions
```

### **4. PRODUCT ROUTES** (`/api/products`)

```
# Public routes:
GET    /api/products                   # Get all active products (with filters)
GET    /api/products/:id               # Get single product details
GET    /api/products/category/:category # Get products by category
GET    /api/products/search            # Search products

# Admin only:
POST   /api/products                   # Create product
PUT    /api/products/:id               # Update product
DELETE /api/products/:id               # Delete product
PUT    /api/products/:id/toggle-status # Enable/disable product
POST   /api/products/:id/upload-image  # Upload product image
```

### **5. CART ROUTES** (`/api/cart`) - Protected (Customer)

```
GET    /api/cart                       # Get user's cart
POST   /api/cart/add                   # Add item to cart
PUT    /api/cart/update/:itemId        # Update cart item
DELETE /api/cart/remove/:itemId        # Remove cart item
DELETE /api/cart/clear                 # Clear entire cart
GET    /api/cart/count                 # Get cart items count
```

### **6. ORDER ROUTES** (`/api/orders`)

```
# Customer routes (protected):
GET    /api/orders                     # Get user's orders
GET    /api/orders/:orderId            # Get single order details
GET    /api/orders/:orderId/invoice    # Download invoice PDF
POST   /api/orders/create              # Create order (from cart)

# Admin routes:
GET    /api/orders/all                 # Get all orders (with filters)
PUT    /api/orders/:orderId/status     # Update order status
POST   /api/orders/:orderId/refund     # Process refund
GET    /api/orders/export              # Export orders to CSV
POST   /api/orders/manual              # Create manual order
```

### **7. PAYMENT ROUTES** (`/api/payment`)

```
POST   /api/payment/create-intent           # Create payment intent
POST   /api/payment/stripe/checkout         # Stripe checkout
POST   /api/payment/paypal/create-order     # PayPal create order
POST   /api/payment/paypal/capture          # PayPal capture
POST   /api/payment/razorpay/create-order   # Razorpay order
POST   /api/payment/razorpay/verify         # Razorpay verify

# Webhooks:
POST   /api/payment/webhook/stripe          # Stripe webhook
POST   /api/payment/webhook/paypal          # PayPal webhook
POST   /api/payment/webhook/razorpay        # Razorpay webhook

# History:
GET    /api/payment/history                 # Get payment history (customer)
GET    /api/payment/all                     # Get all payments (admin)
```

### **8. SUBSCRIPTION ROUTES** (`/api/subscriptions`)

```
# Customer routes (protected):
GET    /api/subscriptions                    # Get user's subscriptions
GET    /api/subscriptions/:id                # Get single subscription
POST   /api/subscriptions/:id/renew          # Renew subscription
PUT    /api/subscriptions/:id/toggle-autorenew # Toggle auto-renew
POST   /api/subscriptions/:id/cancel         # Cancel subscription
GET    /api/subscriptions/:id/history        # Get subscription history

# Admin routes:
GET    /api/subscriptions/all                # Get all subscriptions (filters)
PUT    /api/subscriptions/:id/suspend        # Manually suspend
PUT    /api/subscriptions/:id/unsuspend      # Manually unsuspend
PUT    /api/subscriptions/:id/extend         # Extend expiry date
GET    /api/subscriptions/expiring           # Get expiring soon (7 days)
```

### **9. ADMIN ROUTES** (`/api/admin`)

```
# Dashboard:
GET    /api/admin/dashboard/stats            # Get dashboard statistics
GET    /api/admin/dashboard/revenue          # Get revenue data
GET    /api/admin/dashboard/charts           # Get chart data

# Customer Management:
GET    /api/admin/customers                  # Get all customers (filters)
GET    /api/admin/customers/:id              # Get customer details
PUT    /api/admin/customers/:id              # Update customer
DELETE /api/admin/customers/:id              # Delete customer
PUT    /api/admin/customers/:id/suspend      # Suspend customer
PUT    /api/admin/customers/:id/activate     # Activate customer
POST   /api/admin/customers/:id/send-email   # Send custom email
POST   /api/admin/customers/:id/reset-password # Send password reset

# Analytics:
GET    /api/admin/analytics/revenue          # Revenue analytics
GET    /api/admin/analytics/customers        # Customer analytics
GET    /api/admin/analytics/products         # Product analytics
GET    /api/admin/analytics/regions          # Regional analytics
GET    /api/admin/analytics/export           # Export analytics CSV
```

### **10. IMPERSONATION ROUTES** (`/api/admin/impersonate`)

```
POST   /api/admin/impersonate/start          # Start impersonation
POST   /api/admin/impersonate/end            # End impersonation
GET    /api/admin/impersonate/logs           # Get impersonation logs
POST   /api/admin/impersonate/add-note       # Add note during impersonation
GET    /api/admin/impersonate/logs/:sessionId # Get single session details
```

### **11. CHAT ROUTES** (`/api/chat`)

```
# Customer:
POST   /api/chat/start                       # Start new chat
GET    /api/chat/history                     # Get chat history
POST   /api/chat/message                     # Send message
POST   /api/chat/upload                      # Upload file in chat
POST   /api/chat/close                       # Close chat

# Admin:
GET    /api/chat/active                      # Get active chats
GET    /api/chat/:chatId                     # Get chat details
POST   /api/chat/:chatId/reply               # Reply to chat
POST   /api/chat/:chatId/transfer            # Transfer to another admin
POST   /api/chat/:chatId/close               # Close chat
POST   /api/chat/:chatId/convert-ticket      # Convert to ticket

# AI Bot:
POST   /api/chat/ai/query                    # Query Gemini AI
```

### **12. TICKET ROUTES** (`/api/tickets`)

```
# Customer:
GET    /api/tickets                          # Get user's tickets
GET    /api/tickets/:ticketId                # Get ticket details
POST   /api/tickets/create                   # Create new ticket
POST   /api/tickets/:ticketId/reply          # Reply to ticket
POST   /api/tickets/:ticketId/close          # Close ticket (if resolved)
POST   /api/tickets/:ticketId/rate           # Rate ticket support

# Admin:
GET    /api/tickets/all                      # Get all tickets (filters)
PUT    /api/tickets/:ticketId/assign         # Assign ticket
PUT    /api/tickets/:ticketId/priority       # Change priority
PUT    /api/tickets/:ticketId/status         # Change status
POST   /api/tickets/:ticketId/note           # Add internal note
POST   /api/tickets/:ticketId/reply          # Reply to ticket
POST   /api/tickets/create-behalf            # Create on behalf of customer
```

### **13. NOTIFICATION ROUTES** (`/api/notifications`)

```
# Email Logs (Admin):
GET    /api/notifications/email-logs         # Get all email logs
GET    /api/notifications/email-logs/:id     # Get single email log
POST   /api/notifications/email-logs/:id/resend # Resend email
GET    /api/notifications/email-logs/search  # Search by shopperId

# SMS Logs (Admin):
GET    /api/notifications/sms-logs           # Get all SMS logs
GET    /api/notifications/sms-logs/:id       # Get single SMS log
POST   /api/notifications/sms-logs/:id/resend # Resend SMS

# Send Custom (Admin):
POST   /api/notifications/send-email         # Send custom email
POST   /api/notifications/send-sms           # Send custom SMS
```

### **14. ANALYTICS ROUTES** (`/api/analytics`) - Admin Only

```
GET    /api/analytics/overview               # Overall stats
GET    /api/analytics/revenue                # Revenue breakdown
GET    /api/analytics/customers              # Customer analytics
GET    /api/analytics/products               # Product performance
GET    /api/analytics/regions                # Regional data
GET    /api/analytics/subscriptions          # Subscription analytics
GET    /api/analytics/orders                 # Order analytics
GET    /api/analytics/export                 # Export report
```

### **15. HELP CENTER ROUTES** (`/api/help`)

```
# Public:
GET    /api/help/articles                    # Get all help articles
GET    /api/help/articles/:id                # Get single article
GET    /api/help/articles/category/:category # Get by category
GET    /api/help/articles/search             # Search articles
GET    /api/help/faqs                        # Get all FAQs
POST   /api/help/articles/:id/helpful        # Mark article helpful

# Admin:
POST   /api/help/articles                    # Create article
PUT    /api/help/articles/:id                # Update article
DELETE /api/help/articles/:id                # Delete article
POST   /api/help/faqs                        # Create FAQ
PUT    /api/help/faqs/:id                    # Update FAQ
DELETE /api/help/faqs/:id                    # Delete FAQ
```

### **16. NOTES ROUTES** (`/api/notes`) - Admin Only

```
GET    /api/notes/customer/:customerId       # Get customer notes
POST   /api/notes/customer/:customerId       # Add note to customer
PUT    /api/notes/:noteId                    # Update note
DELETE /api/notes/:noteId                    # Delete note
```

### **17. ADMIN ACTION LOGS** (`/api/admin/action-logs`)

```
GET    /api/admin/action-logs                # Get all action logs
GET    /api/admin/action-logs/:adminId       # Get logs by admin
GET    /api/admin/action-logs/customer/:customerId # Get logs for customer
```

---

## ğŸ“¦ NPM PACKAGES TO INSTALL

### **Backend Packages:**

```bash
# Core
npm install express dotenv cors

# Database
npm install mongoose

# Authentication & Security
npm install bcryptjs jsonwebtoken
npm install express-validator
npm install helmet
npm install express-rate-limit

# Email & SMS
npm install nodemailer
npm install twilio

# Payment Gateways
npm install stripe
npm install @paypal/checkout-server-sdk
npm install razorpay

# Real-time Communication
npm install socket.io

# AI Integration
npm install @google/generative-ai

# Cron Jobs
npm install node-cron

# File Upload
npm install multer
npm install cloudinary  # (optional, for image hosting)

# PDF Generation
npm install pdfkit
npm install html-pdf  # (alternative)

# CSV Export
npm install json2csv

# Two-Factor Authentication
npm install speakeasy
npm install qrcode

# IP Geolocation
npm install geoip-lite
npm install axios  # (for external geo API)

# Utilities
npm install moment  # (date handling)
npm install uuid  # (unique ID generation)
npm install compression  # (response compression)
npm install morgan  # (HTTP logger)

# Development
npm install --save-dev nodemon
npm install --save-dev eslint
```

### **Frontend Packages:**

```bash
# Create Vite React App
npm create vite@latest client -- --template react

cd client

# Core
npm install react-router-dom
npm install axios

# UI & Styling
npm install tailwindcss postcss autoprefixer
npm install @headlessui/react
npm install @heroicons/react

# Forms
npm install react-hook-form
npm install yup @hookform/resolvers

# Notifications
npm install react-toastify

# Real-time
npm install socket.io-client

# Animations
npm install framer-motion

# Charts
npm install chart.js react-chartjs-2
# OR
npm install recharts

# Date Handling
npm install date-fns

# Payment Integration
npm install @stripe/stripe-js @stripe/react-stripe-js

# State Management (if needed beyond Context)
# npm install zustand  # (lightweight alternative to Redux)

# SEO
npm install react-helmet-async

# Utilities
npm install clsx  # (conditional classnames)
npm install react-loading-skeleton  # (loading states)

# Development
npm install --save-dev eslint
npm install --save-dev prettier
```

---

## ğŸ”§ ENVIRONMENT VARIABLES

### **Backend (.env):**

```
# Server
NODE_ENV=development
PORT=5000
CLIENT_URL=http://localhost:5173

# Database
MONGO_URI=mongodb://localhost:27017/cloudservices
# OR MongoDB Atlas:
# MONGO_URI=mongodb+srv://username:password@cluster.mongodb.net/cloudservices

# JWT
JWT_SECRET=your_super_secret_jwt_key_minimum_32_characters_long
JWT_EXPIRE=7d
REFRESH_TOKEN_SECRET=your_refresh_token_secret_key
REFRESH_TOKEN_EXPIRE=30d

# Email (Nodemailer - Gmail)
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your_email@gmail.com
EMAIL_PASS=your_gmail_app_password
EMAIL_FROM=CloudServices <noreply@cloudservices.com>

# Email (SendGrid - Alternative)
# SENDGRID_API_KEY=your_sendgrid_api_key

# SMS (Twilio)
TWILIO_ACCOUNT_SID=your_twilio_account_sid
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_PHONE_NUMBER=+1234567890

# Payment - Stripe
STRIPE_SECRET_KEY=sk_test_...
STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...

# Payment - PayPal
PAYPAL_MODE=sandbox  # or 'live'
PAYPAL_CLIENT_ID=your_paypal_client_id
PAYPAL_CLIENT_SECRET=your_paypal_client_secret

# Payment - Razorpay
RAZORPAY_KEY_ID=your_razorpay_key_id
RAZORPAY_KEY_SECRET=your_razorpay_key_secret

# Google Gemini AI
GEMINI_API_KEY=your_gemini_api_key

# Cloudinary (Optional - for image uploads)
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret

# GeoIP API (Optional)
GEOIP_API_KEY=your_geoip_api_key

# Admin Credentials (for seeding)
ADMIN_EMAIL=admin@cloudservices.com
ADMIN_PASSWORD=secureAdminPassword123

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000  # 15 minutes
RATE_LIMIT_MAX_REQUESTS=100

# Session
SESSION_SECRET=your_session_secret_key

# CORS
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000
```

### **Frontend (.env):**

```
# API Base URL
VITE_API_BASE_URL=http://localhost:5000/api

# Stripe Publishable Key
VITE_STRIPE_PUBLISHABLE_KEY=pk_test_...

# PayPal Client ID
VITE_PAYPAL_CLIENT_ID=your_paypal_client_id

# Razorpay Key ID
VITE_RAZORPAY_KEY_ID=your_razorpay_key_id

# Socket.io URL
VITE_SOCKET_URL=http://localhost:5000

# App Info
VITE_APP_NAME=CloudServices
VITE_APP_URL=http://localhost:5173

# Google Analytics (Optional)
VITE_GA_TRACKING_ID=UA-XXXXXXXXX-X
```

---

## ğŸ”„ DATA FLOW ARCHITECTURE

### **1. USER REGISTRATION FLOW:**
```
Frontend (Register Form)
  â†’ POST /api/auth/register
    â†’ Validate input
    â†’ Check if email exists
    â†’ Hash password
    â†’ Generate shopperId
    â†’ Detect region (IP-based)
    â†’ Create user (isVerified: false)
    â†’ Generate OTP
    â†’ Store OTP in OTPLog
    â†’ Send verification email
    â†’ Return success message
  
Frontend (OTP Modal)
  â†’ POST /api/auth/verify-email
    â†’ Validate OTP
    â†’ Mark user as verified
    â†’ Mark OTP as used
    â†’ Send welcome email
    â†’ Return success + JWT token
    â†’ Frontend: Store token, redirect to dashboard
```

### **2. PRODUCT PURCHASE FLOW:**
```
1. Browse Products
   â†’ GET /api/products (filtered by region)
   
2. Add to Cart
   â†’ POST /api/cart/add
   â†’ Store in Cart collection
   
3. Checkout
   â†’ POST /api/orders/create
     â†’ Validate cart items
     â†’ Check region restrictions
     â†’ Create order (status: pending)
     â†’ Generate orderId
     
4. Payment
   â†’ POST /api/payment/stripe/checkout (or other gateway)
     â†’ Create payment intent
     â†’ Return client secret
     
5. Frontend Payment Processing
   â†’ User enters card details
   â†’ Payment gateway processes
   
6. Webhook (Payment Success)
   â†’ POST /api/payment/webhook/stripe
     â†’ Verify webhook signature
     â†’ Update order status: completed
     â†’ Create subscription entry
     â†’ Calculate expiry date
     â†’ Clear cart
     â†’ Send order confirmation email
     â†’ Send subscription activation email
     â†’ Log emails
     
7. Customer Dashboard
   â†’ GET /api/subscriptions
   â†’ Show active subscription
```

### **3. SUBSCRIPTION EXPIRY FLOW:**
```
Daily Cron Job (runs at 12:00 AM)
  â†’ Query subscriptions where:
     - status: active
     - expiryDate is within next 7 days
  
For each subscription:
  â†’ Check days until expiry
  
  If 7 days before:
    â†’ Send "7 days remaining" email
    â†’ Log email
  
  If 3 days before:
    â†’ Send "3 days remaining" email
    â†’ Log email
  
  If 1 day before:
    â†’ Send "1 day remaining" email
    â†’ Log email
  
  If expired (expiryDate < today):
    â†’ Update status to 'suspended'
    â†’ Send suspension email
    â†’ Log action in AdminActionLog
    â†’ Log email
```

### **4. ADMIN IMPERSONATION FLOW:**
```
1. Admin clicks "View as Customer"
   â†’ POST /api/admin/impersonate/start
     â†’ Validate admin role
     â†’ Create ImpersonationLog entry
     â†’ Generate special JWT with:
        * adminId
        * customerId
        * isImpersonating: true
        * impersonationId
     â†’ Return impersonation token
     
2. Frontend stores impersonation token
   â†’ Redirects to customer portal
   â†’ Shows impersonation banner
   â†’ Attaches X-Impersonation-Token header to all requests
   
3. Backend Middleware (on every request)
   â†’ Check for X-Impersonation-Token
   â†’ Verify token
   â†’ Validate impersonation session
   â†’ Attach admin and customer to request
   â†’ Log page view in ImpersonationLog
   
4. Protected Actions
   â†’ Middleware blocks write operations
   â†’ Returns 403 with message
   
5. Admin exits
   â†’ POST /api/admin/impersonate/end
     â†’ Update ImpersonationLog
     â†’ Calculate duration
     â†’ Log end time
     â†’ Return success
   â†’ Frontend: Clear token, redirect to admin dashboard
```

### **5. CHAT TO TICKET FLOW:**
```
1. Customer starts chat
   â†’ POST /api/chat/start
     â†’ Create Chat document
     â†’ Emit socket event to admins
     â†’ AI bot responds initially
     
2. Customer types message
   â†’ Socket event: 'message'
   â†’ Save to Chat document
   â†’ If AI can't help â†’ escalate to human
   
3. Admin receives notification
   â†’ Opens chat interface
   â†’ Replies via socket
   â†’ Messages saved in real-time
   
4. Admin converts to ticket
   â†’ POST /api/chat/:chatId/convert-ticket
     â†’ Create Ticket document
     â†’ Copy chat history
     â†’ Generate ticketId
     â†’ Link to customer's shopperId
     â†’ Send ticket creation email
     â†’ Close chat
     
5. Ticket workflow continues
   â†’ Admin and customer reply via portal or email
   â†’ All updates logged
   â†’ Email notifications sent
```

---

## ğŸ”’ SECURITY ARCHITECTURE

### **1. Authentication Flow:**
```
Login Request
  â†’ Validate credentials
  â†’ Check if 2FA enabled
    â†’ If yes:
      - Generate OTP
      - Send via email/SMS
      - Store in session
      - Return { requires2FA: true }
    â†’ If no:
      - Generate JWT token
      - Generate refresh token
      - Return tokens
```

### **2. Authorization Layers:**
```
Request
  â†’ auth.middleware (verify JWT)
    â†’ Attach user to request
  â†’ roleCheck.middleware (check role)
    â†’ Allow/deny based on role
  â†’ impersonation.middleware (if impersonating)
    â†’ Validate impersonation token
    â†’ Attach both admin and customer
  â†’ blockWriteInImpersonation.middleware
    â†’ Block if impersonating and write operation
```

### **3. Rate Limiting:**
```
Auth routes: 5 requests per 15 minutes per IP
API routes: 100 requests per 15 minutes per user
Webhook routes: No limit (but verify signatures)
```

### **4. Data Validation:**
```
Request
  â†’ express-validator middleware
  â†’ Custom validators
  â†’ Sanitize inputs
  â†’ Check business rules
  â†’ Proceed or return 400 error
```

---

## ğŸ“Š DATABASE INDEXES (For Performance)

```javascript
User:
  - email (unique)
  - shopperId (unique)
  - region

Product:
  - productId (unique)
  - category
  - isActive
  - availableRegions

Order:
  - orderId (unique)
  - userId
  - paymentStatus
  - createdAt

Subscription:
  - subscriptionId (unique)
  - userId
  - status
  - expiryDate  # Important for cron jobs
  
EmailLog:
  - shopperId
  - sentAt
  - status

Chat:
  - customerId
  - status
  
Ticket:
  - ticketId (unique)
  - userId
  - status
  - assignedTo
```

---

## ğŸš€ DEPLOYMENT ARCHITECTURE

### **Backend Deployment:**
```
Option 1: Railway
  - Connect GitHub repo
  - Auto-deploy on push
  - Set environment variables
  - Add MongoDB addon or use Atlas
  
Option 2: Render
  - Connect GitHub repo
  - Set build command: npm install
  - Set start command: npm start
  - Add environment variables
  - Use external MongoDB Atlas
  
Option 3: Heroku
  - Similar to Railway/Render
  - Use ClearDB for MySQL or mLab for MongoDB
  
Option 4: VPS (DigitalOcean, AWS, etc.)
  - Set up Node.js environment
  - Install PM2 for process management
  - Configure Nginx as reverse proxy
  - Set up SSL with Let's Encrypt
```

### **Frontend Deployment:**
```
Option 1: Vercel (Recommended for React)
  - Connect GitHub repo
  - Auto-detect Vite
  - Set environment variables
  - Auto-deploy on push
  
Option 2: Netlify
  - Similar to Vercel
  - Drag-and-drop build folder option
  
Option 3: Same server as backend
  - Build: npm run build
  - Serve static files from Express
  - Use express.static middleware
```

### **Database Deployment:**
```
MongoDB Atlas (Free Tier):
  - 512MB storage free
  - M0 cluster
  - Shared resources
  - Good for development/small projects
  
Production:
  - Upgrade to M10+ cluster
  - Dedicated resources
  - Automatic backups
  - Better performance
```

---

## ğŸ“ˆ SCALABILITY CONSIDERATIONS

### **Database:**
```
- Use indexes on frequently queried fields
- Implement pagination on all list endpoints
- Use aggregation for analytics
- Consider Redis for caching frequently accessed data
- Archive old logs to separate collection
```

### **API:**
```
- Implement rate limiting per user
- Use compression middleware
- Enable CORS only for specific origins
- Implement API versioning (/api/v1/...)
- Use query string caching for public routes
```

### **Real-time:**
```
- Use Socket.io rooms for chat isolation
- Implement connection pooling
- Limit concurrent connections per user
- Use Redis adapter for Socket.io in multi-server setup
```

### **File Storage:**
```
- Use Cloudinary or AWS S3 for images
- Implement file size limits
- Validate file types
- Generate thumbnails for images
```

---

## ğŸ”§ CRON JOB SCHEDULE

```javascript
Expiry Check: Every day at 12:00 AM
  â†’ Check subscriptions expiring in 7, 3, 1 days
  â†’ Send reminder emails

Auto-Suspend: Every day at 12:30 AM
  â†’ Suspend expired subscriptions
  â†’ Send suspension emails

Cleanup Job: Every Sunday at 2:00 AM
  â†’ Delete old OTP logs (> 30 days)
  â†’ Archive old email logs (> 90 days)
  â†’ Delete failed payment records (> 180 days)

Auto-Renewal: Every day at 11:00 PM
  â†’ Check subscriptions expiring tomorrow with autoRenew ON
  â†’ Process payments
  â†’ Extend subscriptions or notify failure
```

---

**That's your complete backend architecture buddy! Everything you need to know without code - just implementation info! ğŸš€**

You now have:
- âœ… Complete folder structure
- âœ… All API endpoints mapped
- âœ… Package lists
- âœ… Environment variables
- âœ… Data flow diagrams
- âœ… Security architecture
- âœ… Deployment strategy

Start building phase by phase using the mega prompts! ğŸ’ª